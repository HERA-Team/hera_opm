[Options]
pols = xx,xy,yx,yy
path_to_do_scripts = ~/hera/hera_opm/hera_opm/data/idr2/task_scripts
conda_env = hera
ex_ants_path = ~/hera/hera_opm/hera_opm/data/idr2/bad_ants
base_mem = 10000
base_cpu = 1

[ABSCAL_OPTS]
model_files_glob = /lustre/aoc/projects/hera/nkern/data/H1C/2485116/zen.2485116.*.xx.HH.uvXRS

[DELAY_XRFI_OPTS]
standoff = 15
horizon = 1
tol = 1e-9
window = none
skip_wgt = 0.1
maxiter = 100
kt_size = 8
kf_size = 8
sig_init = 6
sig_adj = 2
px_threshold = 0.1
freq_threshold = 0.5
time_threshold = 0.05

[DELAY_XRFI_APPLY_OPTS]
extension = R
output_npx_ext = .flags.applied.npz

[CAL_SMOOTH_OPTS]
time_scale=120
mirror_sigmas=5
tol = 1e-9

[DELAY_OPTS]
standoff = 15
horizon = 1
tol = 1e-9
window = none
skip_wgt = 0.1
maxiter = 100

[WorkFlow]
actions = FIRSTCAL, FIRSTCAL_METRICS, OMNICAL, OMNICAL_METRICS, OMNI_APPLY,
	  ABSCAL, ABSCAL_APPLY, DELAY_XRFI, DELAY_XRFI_APPLY, CAL_SMOOTH,
	  CAL_SMOOTH_APPLY, DELAY


[FIRSTCAL]
args = {basename}, ${Options:ex_ants_path}

[FIRSTCAL_METRICS]
args = {basename}

[OMNICAL]
prereqs = FIRSTCAL_METRICS
args = {basename}, ${Options:ex_ants_path}

[OMNICAL_METRICS]
prereqs = OMNICAL
args = {basename}

[OMNI_APPLY]
prereqs = OMNICAL_METRICS
args = {basename}

[ABSCAL]
prereqs = OMNI_APPLY
args = {basename}, ${ABSCAL_OPTS:model_files_glob}

[ABSCAL_APPLY]
prereqs = ABSCAL
args = {basename}

[DELAY_XRFI]
prereqs = ABSCAL
args = {basename}, ${DELAY_XRFI_OPTS:standoff}, ${DELAY_XRFI_OPTS:horizon},
     ${DELAY_XRFI_OPTS:tol}, ${DELAY_XRFI_OPTS:window}, ${DELAY_XRFI_OPTS:skip_wgt},
     ${DELAY_XRFI_OPTS:maxiter}, ${DELAY_XRFI_OPTS:kt_size}, ${DELAY_XRFI_OPTS:kf_size},
     ${DELAY_XRFI_OPTS:sig_init}, ${DELAY_XRFI_OPTS:sig_adj},
     ${DELAY_XRFI_OPTS:px_threshold}, ${DELAY_XRFI_OPTS:freq_threshold},
     ${DELAY_XRFI_OPTS:time_threshold}

[DELAY_XRFI_APPLY]
prereqs = DELAY_XRFI
args = {basename}, ${DELAY_XRFI_APPLY_OPTS:extension}, ${DELAY_XRFI_APPLY_OPTS:output_npz_ext}

[CAL_SMOOTH]
prereqs = DELAY_XRFI_APPLY
time_prereqs = DELAY_XRFI
args = {basename}, {prev_basename}, {next_basename}, ${CAL_SMOOTH_OPTS:time_scale},
     ${CAL_SMOOTH_OPTS:mirror_sigmas}, ${CAL_SMOOTH_OPTS:tol}

[CAL_SMOOTH_APPLY]
prereqs = CAL_SMOOTH
args = {basename}

[DELAY]
prereqs = CAL_SMOOTH
args = {basename}, ${DELAY_OPTS:standoff}, ${DELAY_OPTS:horizon}, ${DELAY_OPTS:tol},
     ${DELAY_OPTS:window}, ${DELAY_OPTS:skip_wgt}, ${DELAY_OPTS:maxiter}
